{
    "name": "complex_workflow",
    "description": "综合示例：包含多种任务类型和嵌套结构",
    "version": 1,
    "tasks": [
        {
            "name": "initialize",
            "taskReferenceName": "init_ref",
            "type": "SIMPLE",
            "inputParameters": {
                "workflowId": "${workflow.workflowId}"
            }
        },
        {
            "name": "check_environment",
            "taskReferenceName": "env_check_ref",
            "type": "DECISION",
            "inputParameters": {
                "environment": "${workflow.input.environment}"
            },
            "caseValueParam": "environment",
            "decisionCases": {
                "production": [
                    {
                        "name": "prod_validation",
                        "taskReferenceName": "prod_valid_ref",
                        "type": "SIMPLE",
                        "inputParameters": {
                            "strict": true
                        }
                    },
                    {
                        "name": "prod_parallel_tasks",
                        "taskReferenceName": "prod_fork_ref",
                        "type": "FORK_JOIN",
                        "forkTasks": [
                            [
                                {
                                    "name": "security_check",
                                    "taskReferenceName": "security_ref",
                                    "type": "HTTP",
                                    "inputParameters": {
                                        "http_request": {
                                            "uri": "https://api.example.com/security/check",
                                            "method": "POST"
                                        }
                                    }
                                }
                            ],
                            [
                                {
                                    "name": "compliance_check",
                                    "taskReferenceName": "compliance_ref",
                                    "type": "SIMPLE",
                                    "inputParameters": {
                                        "level": "strict"
                                    }
                                }
                            ]
                        ]
                    }
                ],
                "staging": [
                    {
                        "name": "staging_validation",
                        "taskReferenceName": "staging_valid_ref",
                        "type": "SIMPLE",
                        "inputParameters": {
                            "strict": false
                        }
                    }
                ]
            },
            "defaultCase": [
                {
                    "name": "dev_validation",
                    "taskReferenceName": "dev_valid_ref",
                    "type": "SIMPLE",
                    "inputParameters": {
                        "strict": false,
                        "skipChecks": true
                    }
                }
            ]
        },
        {
            "name": "process_data_loop",
            "taskReferenceName": "loop_ref",
            "type": "DO_WHILE",
            "inputParameters": {
                "items": "${init_ref.output.items}"
            },
            "loopCondition": "if ($.loop_ref['iteration'] < $.init_ref.output.itemCount) { true; } else { false; }",
            "loopOver": [
                {
                    "name": "process_item",
                    "taskReferenceName": "process_item_ref",
                    "type": "SIMPLE",
                    "inputParameters": {
                        "item": "${workflow.input.items[$.loop_ref.iteration]}"
                    }
                },
                {
                    "name": "transform_item",
                    "taskReferenceName": "transform_item_ref",
                    "type": "JSON_JQ_TRANSFORM",
                    "inputParameters": {
                        "data": "${process_item_ref.output}",
                        "queryExpression": ".result"
                    }
                }
            ]
        },
        {
            "name": "invoke_sub_workflow",
            "taskReferenceName": "sub_wf_ref",
            "type": "SUB_WORKFLOW",
            "inputParameters": {
                "workflowInput": {
                    "data": "${loop_ref.output}"
                }
            },
            "subWorkflowParam": {
                "name": "data_aggregation_workflow",
                "version": 1
            }
        },
        {
            "name": "final_processing",
            "taskReferenceName": "final_ref",
            "type": "FORK_JOIN",
            "forkTasks": [
                [
                    {
                        "name": "save_to_database",
                        "taskReferenceName": "db_save_ref",
                        "type": "SIMPLE",
                        "inputParameters": {
                            "data": "${sub_wf_ref.output}"
                        }
                    }
                ],
                [
                    {
                        "name": "publish_event",
                        "taskReferenceName": "event_ref",
                        "type": "EVENT",
                        "inputParameters": {
                            "event": "workflow_completed",
                            "data": "${sub_wf_ref.output}"
                        }
                    }
                ],
                [
                    {
                        "name": "send_notification",
                        "taskReferenceName": "notify_ref",
                        "type": "KAFKA_PUBLISH",
                        "inputParameters": {
                            "topic": "workflow-notifications",
                            "message": {
                                "workflowId": "${workflow.workflowId}",
                                "status": "completed"
                            }
                        }
                    }
                ]
            ]
        },
        {
            "name": "cleanup",
            "taskReferenceName": "cleanup_ref",
            "type": "SIMPLE",
            "inputParameters": {
                "workflowId": "${workflow.workflowId}"
            }
        }
    ],
    "inputParameters": [
        "environment",
        "items"
    ],
    "outputParameters": {
        "result": "${cleanup_ref.output}",
        "processedItems": "${loop_ref.output}",
        "aggregatedData": "${sub_wf_ref.output}"
    },
    "schemaVersion": 2,
    "ownerEmail": "team@example.com",
    "timeoutSeconds": 3600
}